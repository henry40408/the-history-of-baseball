---
title: "The History of Baseball"
author: "Heng-Yi Wu <101306008@nccu.edu.tw>"
date: "2016年6月19日"
output: html_document
---

# The History of Baseball

> Source: [https://www.kaggle.com/kaggle/the-history-of-baseball](https://www.kaggle.com/kaggle/the-history-of-baseball)

We have more ideas for analysis than games in a season, but here are a few we’d really love to see:

```{r setup, include=FALSE}
if (!require("data.table")) {
  install.packages("data.table", repos="http://cran.rstudio.com/")
}

if (!require("DT")) {
  install.packages("DT", repos="http://cran.rstudio.com/")
}
```

## Is there a most error-prone position?

> 在棒球中有一個失誤率最高的守備位置嗎?

### 分析

輸入資料，根據 `README`，守備位置與失誤率的資料放在 `fielding.csv`。

```{r}
fieldings.raw <- read.csv("raw/fielding.csv")
```

使用 `data.table` 依據 **守備位置** (`pos`, position) 分組，計算平均失誤率。

```{r}
library(data.table)
fieldings.table <- data.table(fieldings.raw)
fieldings.aggregated <- fieldings.table[, mean(e, na.rm=TRUE), by=pos]
names(fieldings.aggregated) <- c("position", "error_rate_mean")
```

輸出資料。

```{r}
library(DT)
DT::datatable(fieldings.aggregated)
```

### 結論

1. 位置 **`r fieldings.aggregated$position[1]`** 平均有最高的失誤率。
2. DH 是 **指定打擊**，不記錄失誤率，因此分析結果會顯示 **NA**。

## When do players at different positions peak?

> 各個不同位置的球員的巔峰期分別在什麼時候?

## Are the best performers selected for all-star game?

> 被選進明星賽的都是表現最好的球員嗎?

## How many walks does it take for a starting pitcher to get pulled?

> 多少次保送會讓先發球員被換下來?

### 分析

載入原始資料，這次使用的是 `raw/picthing.csv`，表格包含每季比賽 **球員** (`player_id`, player) 、 **先發次數** (`gs`, games started) 與 **季保送次數** (`bb`, walks)。

```{r}
pitchings.raw <- read.csv("raw/pitching.csv")
```

一樣使用 `data.table` 分析數據。

```{r}
library(data.table)
pitchings.table <- data.table(pitchings.raw)
```

以球員為資料分組，取得球員每季平均每場比賽保送次數。由於球員一旦被換下場之後就不會再上場，所以不必擔心需要合併計算的問題。

```{r}
walks_per_game <- function(gs, bb) ifelse(!gs, 0, bb/gs)
pitchings.walks_per_game <- pitchings.table[, c("wpg") := walks_per_game(pitchings.table$gs, pitchings.table$bb), with=FALSE]
pitchings.aggregated <- pitchings.walks_per_game[, mean(wpg, na.rm=TRUE), by=player_id]
names(pitchings.aggregated) <- c("player", "walks_mean")
```

再統計所有球員的平均。

```{r}
mean(pitchings.aggregated$walks_mean)
```

### 結論

球員每場平均投出 **`r mean(pitchings.aggregated$walks_mean)`** 次保送會被換下場。

## Do players with a high ground into double play (GIDP) have a lower batting average?

> 容易打出滾地安打的球員會有比較低的打擊率嗎?

### 分析

首先定義打擊率公式。

```{r}
batting_rate <- function(h, ab) ifelse(ab == 0, 0, h / ab)
```

導入打擊者資料。

```{r}
battings.raw <- read.csv("raw/batting.csv")
battings.table <- data.table(battings.raw)
```

為每位打者加上打擊率資料。

```{r}
battings.with_rate <- battings.table[, c("rate") := batting_rate(battings.table$ab, battings.table$h), with=FALSE]
battings.gidp_rate <- battings.with_rate[, c("g_idp", "rate"), with=FALSE]
battings.cor <- battings.gidp_rate[, c("cor") := cor(g_idp, rate), with=FALSE]
```

最後使用相關係數分析。

```{r}
cor(battings.gidp_rate$g_idp, battings.gidp_rate$rate, use="complete")
```

### 結論

GIDP 與打擊率之間的相關係數為 **`r cor(battings.gidp_rate$g_idp, battings.gidp_rate$rate, use="complete")`**，屬於 **中度相關**，亦即 GIDP 與打擊率有一定關係。

## Which players are the most likely to choke during the post-season?

> 哪位球員最容易在季後在被逆轉?

## Why should or shouldn’t the National League adopt the designated hitter rule?

> 聯盟應不應該採用指定打擊(不用守備只要打擊)的規則? 為什麼?